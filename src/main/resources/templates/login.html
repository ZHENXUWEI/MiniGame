<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å½• - æ­¦å™¨äº¤æ˜“ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .login-container {
            width: 100%;
            max-width: 400px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .login-header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .login-header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
            font-weight: 300;
            background: linear-gradient(45deg, #3498db, #2ecc71);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .login-header p {
            opacity: 0.8;
            font-size: 1.1em;
        }

        .login-content {
            padding: 30px;
        }

        .login-form {
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .login-button {
            width: 100%;
            height: 45px;
            font-size: 1.1em;
        }

        .register-link {
            text-align: center;
            margin-top: 20px;
            color: #7f8c8d;
        }

        .register-link a {
            color: #3498db;
            text-decoration: none;
            font-weight: 500;
        }

        .register-link a:hover {
            text-decoration: underline;
        }

        .demo-accounts {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-size: 0.9em;
            color: #7f8c8d;
        }

        .demo-accounts h4 {
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .demo-account {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            padding: 5px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .demo-account:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .demo-account-btn {
            background: none;
            border: none;
            color: #3498db;
            cursor: pointer;
            text-decoration: underline;
        }

        .demo-account-btn:hover {
            color: #2980b9;
        }
    </style>
</head>
<body>
<div id="app" class="login-container">
    <!-- ç™»å½•å¤´éƒ¨ -->
    <div class="login-header">
        <h1>ğŸ”« æ­¦å™¨äº¤æ˜“ç³»ç»Ÿ</h1>
        <p>è¯·ç™»å½•æ‚¨çš„è´¦æˆ·</p>
    </div>

    <!-- ç™»å½•å†…å®¹ -->
    <div class="login-content">
        <el-form
                :model="loginForm"
                :rules="loginRules"
                ref="loginFormRef"
                class="login-form">

            <div class="form-group">
                <el-form-item prop="username">
                    <el-input
                            v-model="loginForm.username"
                            placeholder="è¯·è¾“å…¥ç”¨æˆ·å"
                            size="large">
                        <template #prefix>
                            <i class="el-input__icon">ğŸ‘¤</i>
                        </template>
                    </el-input>
                </el-form-item>
            </div>

            <div class="form-group">
                <el-form-item prop="password">
                    <el-input
                            v-model="loginForm.password"
                            type="password"
                            placeholder="è¯·è¾“å…¥å¯†ç "
                            size="large"
                            show-password>
                        <template #prefix>
                            <i class="el-input__icon">ğŸ”’</i>
                        </template>
                    </el-input>
                </el-form-item>
            </div>

            <el-button
                    type="primary"
                    class="login-button"
                    :loading="loading"
                    @click="handleLogin">
                {{ loading ? 'ç™»å½•ä¸­...' : 'ç™»å½•' }}
            </el-button>
        </el-form>

        <div class="register-link">
            æ²¡æœ‰è´¦æˆ·ï¼Ÿ <a href="javascript:void(0)" @click="showRegister = true">ç«‹å³æ³¨å†Œ</a>
        </div>

        <!-- æ¼”ç¤ºè´¦æˆ·ä¿¡æ¯ -->
        <div class="demo-accounts">
            <h4>æ¼”ç¤ºè´¦æˆ·ï¼ˆç‚¹å‡»è‡ªåŠ¨å¡«å……ï¼‰ï¼š</h4>
            <div class="demo-account">
                <span>ç®¡ç†å‘˜è´¦æˆ·</span>
                <button class="demo-account-btn" @click="fillDemoAccount('admin')">ä½¿ç”¨æ­¤è´¦æˆ·</button>
            </div>
            <div class="demo-account">
                <span>ç©å®¶è´¦æˆ·</span>
                <button class="demo-account-btn" @click="fillDemoAccount('player1')">ä½¿ç”¨æ­¤è´¦æˆ·</button>
            </div>
            <div class="demo-account">
                <span>æµ‹è¯•è´¦æˆ·</span>
                <button class="demo-account-btn" @click="fillDemoAccount('test')">ä½¿ç”¨æ­¤è´¦æˆ·</button>
            </div>
        </div>
    </div>

    <!-- æ³¨å†Œå¯¹è¯æ¡† -->
    <el-dialog
            v-model="showRegister"
            title="ç”¨æˆ·æ³¨å†Œ"
            width="400px">
        <el-form
                :model="registerForm"
                :rules="registerRules"
                ref="registerFormRef">

            <el-form-item label="ç”¨æˆ·å" prop="username" label-width="80px">
                <el-input
                        v-model="registerForm.username"
                        placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
                </el-input>
            </el-form-item>

            <el-form-item label="å¯†ç " prop="password" label-width="80px">
                <el-input
                        v-model="registerForm.password"
                        type="password"
                        placeholder="è¯·è¾“å…¥å¯†ç "
                        show-password>
                </el-input>
            </el-form-item>

            <el-form-item label="ç¡®è®¤å¯†ç " prop="confirmPassword" label-width="80px">
                <el-input
                        v-model="registerForm.confirmPassword"
                        type="password"
                        placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç "
                        show-password>
                </el-input>
            </el-form-item>

            <el-form-item label="æ˜µç§°" prop="nickname" label-width="80px">
                <el-input
                        v-model="registerForm.nickname"
                        placeholder="è¯·è¾“å…¥æ˜µç§°">
                </el-input>
            </el-form-item>
        </el-form>

        <template #footer>
            <el-button @click="showRegister = false">å–æ¶ˆ</el-button>
            <el-button type="primary" @click="handleRegister" :loading="registerLoading">
                {{ registerLoading ? 'æ³¨å†Œä¸­...' : 'æ³¨å†Œ' }}
            </el-button>
        </template>
    </el-dialog>
</div>

<script>
    const { createApp, ref } = Vue;
    const { ElMessage, ElMessageBox } = ElementPlus;

    createApp({
        setup() {
            const loginFormRef = ref(null);
            const registerFormRef = ref(null);
            const loading = ref(false);
            const registerLoading = ref(false);
            const showRegister = ref(false);

            const loginForm = ref({
                username: '',
                password: ''
            });

            const registerForm = ref({
                username: '',
                password: '',
                confirmPassword: '',
                nickname: ''
            });

            const loginRules = {
                username: [
                    { required: true, message: 'è¯·è¾“å…¥ç”¨æˆ·å', trigger: 'blur' },
                    { min: 3, max: 20, message: 'ç”¨æˆ·åé•¿åº¦åœ¨ 3 åˆ° 20 ä¸ªå­—ç¬¦', trigger: 'blur' }
                ],
                password: [
                    { required: true, message: 'è¯·è¾“å…¥å¯†ç ', trigger: 'blur' },
                    { min: 6, max: 20, message: 'å¯†ç é•¿åº¦åœ¨ 6 åˆ° 20 ä¸ªå­—ç¬¦', trigger: 'blur' }
                ]
            };

            const registerRules = {
                username: [
                    { required: true, message: 'è¯·è¾“å…¥ç”¨æˆ·å', trigger: 'blur' },
                    { min: 3, max: 20, message: 'ç”¨æˆ·åé•¿åº¦åœ¨ 3 åˆ° 20 ä¸ªå­—ç¬¦', trigger: 'blur' }
                ],
                password: [
                    { required: true, message: 'è¯·è¾“å…¥å¯†ç ', trigger: 'blur' },
                    { min: 6, max: 20, message: 'å¯†ç é•¿åº¦åœ¨ 6 åˆ° 20 ä¸ªå­—ç¬¦', trigger: 'blur' }
                ],
                confirmPassword: [
                    { required: true, message: 'è¯·ç¡®è®¤å¯†ç ', trigger: 'blur' },
                    {
                        validator: (rule, value, callback) => {
                            if (value !== registerForm.value.password) {
                                callback(new Error('ä¸¤æ¬¡è¾“å…¥å¯†ç ä¸ä¸€è‡´'));
                            } else {
                                callback();
                            }
                        },
                        trigger: 'blur'
                    }
                ],
                nickname: [
                    { required: true, message: 'è¯·è¾“å…¥æ˜µç§°', trigger: 'blur' },
                    { min: 2, max: 20, message: 'æ˜µç§°é•¿åº¦åœ¨ 2 åˆ° 20 ä¸ªå­—ç¬¦', trigger: 'blur' }
                ]
            };

            const handleLogin = async () => {
                if (!loginFormRef.value) return;

                try {
                    const valid = await loginFormRef.value.validate();
                    if (!valid) return;

                    loading.value = true;
                    const response = await axios.post('/api/login', loginForm.value);

                    if (response.data.success) {
                        ElMessage.success('ç™»å½•æˆåŠŸï¼');
                        // è·³è½¬åˆ°èƒŒåŒ…é¡µé¢
                        window.location.href = '/backpack';
                    } else {
                        ElMessage.error(response.data.message);
                    }
                } catch (error) {
                    ElMessage.error('ç™»å½•å¤±è´¥: ' + error.message);
                } finally {
                    loading.value = false;
                }
            };

            const handleRegister = async () => {
                if (!registerFormRef.value) return;

                try {
                    const valid = await registerFormRef.value.validate();
                    if (!valid) return;

                    registerLoading.value = true;
                    const response = await axios.post('/api/register', registerForm.value);

                    if (response.data.success) {
                        ElMessage.success('æ³¨å†ŒæˆåŠŸï¼');
                        showRegister.value = false;
                        // æ¸…ç©ºæ³¨å†Œè¡¨å•
                        registerForm.value = {
                            username: '',
                            password: '',
                            confirmPassword: '',
                            nickname: ''
                        };
                    } else {
                        ElMessage.error(response.data.message);
                    }
                } catch (error) {
                    ElMessage.error('æ³¨å†Œå¤±è´¥: ' + error.message);
                } finally {
                    registerLoading.value = false;
                }
            };

            // è‡ªåŠ¨å¡«å……æ¼”ç¤ºè´¦æˆ·
            const fillDemoAccount = (username) => {
                loginForm.value.username = username;
                loginForm.value.password = '123456';
                ElMessage.success(`å·²å¡«å…… ${username} è´¦æˆ·ä¿¡æ¯`);
            };

            return {
                loginFormRef,
                registerFormRef,
                loading,
                registerLoading,
                showRegister,
                loginForm,
                registerForm,
                loginRules,
                registerRules,
                handleLogin,
                handleRegister,
                fillDemoAccount
            };
        }
    })
        .use(ElementPlus)
        .mount('#app');
</script>
</body>
</html>