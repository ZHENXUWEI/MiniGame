<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ’è¡Œæ¦œ - è¿·ä½ æ¸¸æˆ</title>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #333;
        }

        .ranking-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            min-height: 100vh;
        }

        /* å¤´éƒ¨æ ·å¼ */
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 25px 30px;
            text-align: center;
        }

        .header-title {
            font-size: 2.5em;
            font-weight: 300;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #3498db, #2ecc71);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-subtitle {
            font-size: 1.1em;
            opacity: 0.8;
            margin-bottom: 20px;
        }

        .user-ranking-info {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            max-width: 600px;
            margin: 0 auto;
        }

        .user-rank-main {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .user-rank {
            font-size: 1.8em;
            font-weight: bold;
            color: #f39c12;
        }

        .user-rank-tier {
            font-size: 1.3em;
            font-weight: bold;
        }

        .user-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .user-stat {
            text-align: center;
            padding: 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
        }

        .stat-label {
            font-size: 0.8em;
            opacity: 0.8;
            margin-bottom: 3px;
        }

        .stat-value {
            font-size: 1.1em;
            font-weight: bold;
        }

        .nav-buttons {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        /* æ§åˆ¶é¢æ¿ */
        .controls-panel {
            background: #f8f9fa;
            padding: 20px 30px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .filter-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .stats-info {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        /* æ’è¡Œæ¦œä¸»ä½“ */
        .ranking-main {
            padding: 30px;
        }

        /* é¡¶çº§ç©å®¶å±•ç¤º */
        .top-players {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 40px;
        }

        .top-player-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 3px solid transparent;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .top-player-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .top-player-card.first {
            border-color: #f39c12;
            background: linear-gradient(135deg, #fffaf0, #fff5e6);
        }

        .top-player-card.second {
            border-color: #bdc3c7;
            background: linear-gradient(135deg, #f8f9fa, #ecf0f1);
        }

        .top-player-card.third {
            border-color: #cd7f32;
            background: linear-gradient(135deg, #fef9f3, #fdf2e9);
        }

        .rank-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
            color: white;
        }

        .first .rank-badge {
            background: #f39c12;
        }

        .second .rank-badge {
            background: #7f8c8d;
        }

        .third .rank-badge {
            background: #cd7f32;
        }

        .player-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 15px;
            background: linear-gradient(135deg, #3498db, #2ecc71);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            color: white;
        }

        .player-name {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 8px;
            color: #2c3e50;
        }

        .player-tier {
            display: inline-block;
            padding: 4px 12px;
            background: #3498db;
            color: white;
            border-radius: 15px;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .player-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }

        .player-stat {
            text-align: center;
        }

        .stat-number {
            font-size: 1.2em;
            font-weight: bold;
            color: #2c3e50;
        }

        .stat-desc {
            font-size: 0.8em;
            color: #7f8c8d;
        }

        .bot-indicator {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #e74c3c;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7em;
        }

        /* æ’è¡Œæ¦œåˆ—è¡¨ */
        .ranking-list {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .ranking-header {
            display: grid;
            grid-template-columns: 80px 1fr 120px 100px 100px 100px 100px;
            gap: 15px;
            padding: 15px 20px;
            background: #34495e;
            color: white;
            font-weight: bold;
        }

        .ranking-row {
            display: grid;
            grid-template-columns: 80px 1fr 120px 100px 100px 100px 100px;
            gap: 15px;
            padding: 15px 20px;
            border-bottom: 1px solid #f8f9fa;
            transition: all 0.2s ease;
            align-items: center;
        }

        .ranking-row:hover {
            background: #f8f9fa;
        }

        .ranking-row.current-user {
            background: #e8f4fd;
            border-left: 4px solid #3498db;
        }

        .rank-number {
            text-align: center;
            font-weight: bold;
            font-size: 1.1em;
        }

        .rank-1 {
            color: #f39c12;
        }

        .rank-2 {
            color: #7f8c8d;
        }

        .rank-3 {
            color: #cd7f32;
        }

        .rank-4-10 {
            color: #3498db;
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .player-avatar-small {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3498db, #2ecc71);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2em;
        }

        .player-details {
            flex: 1;
        }

        .player-display-name {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 3px;
        }

        .player-level {
            font-size: 0.8em;
            color: #7f8c8d;
        }

        .rank-tier-info {
            text-align: center;
        }

        .tier-icon {
            width: 40px;
            height: 40px;
            margin: 0 auto 5px;
            background: #f8f9fa;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
        }

        .tier-name {
            font-size: 0.9em;
            font-weight: bold;
            color: #2c3e50;
        }

        .tier-sub {
            font-size: 0.8em;
            color: #7f8c8d;
        }

        .performance-grade {
            text-align: center;
            font-weight: bold;
            font-size: 1.1em;
        }

        .grade-S { color: #e74c3c; }
        .grade-A { color: #e67e22; }
        .grade-B { color: #f39c12; }
        .grade-C { color: #3498db; }
        .grade-D { color: #7f8c8d; }

        .win-rate {
            text-align: center;
            font-weight: bold;
        }

        .win-rate-high { color: #27ae60; }
        .win-rate-medium { color: #f39c12; }
        .win-rate-low { color: #e74c3c; }

        .kd-ratio {
            text-align: center;
            font-weight: bold;
        }

        /* æ®µä½ç»Ÿè®¡ */
        .tier-statistics {
            margin-top: 40px;
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .statistics-title {
            font-size: 1.4em;
            margin-bottom: 20px;
            color: #2c3e50;
            text-align: center;
            font-weight: 500;
        }

        .tier-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .tier-stat-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border-left: 4px solid;
        }

        .tier-stat-card.legend { border-color: #e74c3c; }
        .tier-stat-card.mythic { border-color: #9b59b6; }
        .tier-stat-card.master { border-color: #e67e22; }
        .tier-stat-card.diamond { border-color: #3498db; }
        .tier-stat-card.platinum { border-color: #1abc9c; }
        .tier-stat-card.gold { border-color: #f39c12; }
        .tier-stat-card.silver { border-color: #bdc3c7; }
        .tier-stat-card.bronze { border-color: #cd7f32; }

        .tier-stat-name {
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .tier-stat-count {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .tier-stat-percentage {
            font-size: 0.9em;
            color: #7f8c8d;
        }

        /* åŠ è½½çŠ¶æ€ */
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: #7f8c8d;
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: #7f8c8d;
        }

        .empty-state i {
            font-size: 4em;
            margin-bottom: 20px;
            color: #bdc3c7;
            display: block;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1024px) {
            .top-players {
                grid-template-columns: 1fr;
            }

            .ranking-header,
            .ranking-row {
                grid-template-columns: 60px 1fr 100px 80px 80px;
            }

            .ranking-header div:nth-child(6),
            .ranking-header div:nth-child(7),
            .ranking-row div:nth-child(6),
            .ranking-row div:nth-child(7) {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 20px 15px;
            }

            .controls-panel {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-controls {
                justify-content: center;
            }

            .ranking-header,
            .ranking-row {
                grid-template-columns: 50px 1fr 80px;
                gap: 10px;
                padding: 12px 15px;
            }

            .ranking-header div:nth-child(4),
            .ranking-header div:nth-child(5),
            .ranking-header div:nth-child(6),
            .ranking-header div:nth-child(7),
            .ranking-row div:nth-child(4),
            .ranking-row div:nth-child(5),
            .ranking-row div:nth-child(6),
            .ranking-row div:nth-child(7) {
                display: none;
            }

            .tier-stats-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .user-rank-main {
                flex-direction: column;
                gap: 10px;
            }

            .user-stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* ç°ä»£åŒ–å¯¼èˆªæ æ ·å¼ */
        .global-nav {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            padding: 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            padding: 0 20px;
            height: 70px;
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-right: 40px;
            text-decoration: none;
        }

        .brand-logo {
            font-size: 2em;
            background: linear-gradient(45deg, #3498db, #2ecc71);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }

        .brand-text {
            font-size: 1.4em;
            font-weight: bold;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .nav-menu {
            display: flex;
            list-style: none;
            margin: 0;
            padding: 0;
            gap: 5px;
        }

        .nav-item {
            position: relative;
        }

        .nav-link {
            color: #ecf0f1;
            text-decoration: none;
            font-weight: 500;
            padding: 15px 20px;
            border-radius: 8px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.95em;
            position: relative;
            overflow: hidden;
        }

        .nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }

        .nav-link:hover::before {
            left: 100%;
        }

        .nav-link:hover {
            background: rgba(52, 152, 219, 0.1);
            color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        .nav-link.active {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
        }

        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 3px;
            background: #2ecc71;
            border-radius: 2px;
        }

        .nav-badge {
            background: #e74c3c;
            color: white;
            font-size: 0.7em;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 5px;
        }

        .nav-actions {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #ecf0f1;
            font-size: 0.9em;
        }

        .user-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3498db, #2ecc71);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
        }

        .logout-btn {
            background: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
            border: 1px solid rgba(231, 76, 60, 0.3);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
        }

        .logout-btn:hover {
            background: #e74c3c;
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.4);
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .nav-container {
                padding: 0 15px;
                height: 60px;
            }

            .brand-text {
                display: none;
            }

            .nav-link span:last-child {
                display: none;
            }

            .nav-link {
                padding: 12px 15px;
            }

            .user-info span {
                display: none;
            }
        }
    </style>
</head>
<body>
<!-- å…¨å±€å¯¼èˆª -->
<nav class="global-nav">
    <ul class="nav-menu">
        <li class="nav-item">
            <a href="/backpack" class="nav-link active">ğŸ’ æˆ‘çš„èƒŒåŒ…</a>
        </li>
        <li class="nav-item">
            <a href="/market" class="nav-link">ğŸª æ­¦å™¨å¸‚åœº</a>
        </li>
        <li class="nav-item">
            <a href="/battle" class="nav-link">âš”ï¸ æˆ˜æ–—ç³»ç»Ÿ</a>
        </li>
        <li class="nav-item">
            <a href="/battle/ranking" class="nav-link">ğŸ† æ’è¡Œæ¦œ</a>
        </li>
        <li class="nav-item" style="margin-left: auto;">
            <a href="javascript:void(0)" class="nav-link" @click="handleLogout">ğŸšª é€€å‡ºç™»å½•</a>
        </li>
    </ul>
</nav>
<div id="app" class="ranking-container">
    <!-- å¤´éƒ¨ -->
    <div class="header">
        <h1 class="header-title">ğŸ† æ’è¡Œæ¦œ</h1>
        <p class="header-subtitle">å…¨çƒç©å®¶ç«æŠ€æ’å - å±•ç¤ºä½ çš„å®åŠ›</p>

        <!-- ç”¨æˆ·æ’åä¿¡æ¯ -->
        <div class="user-ranking-info" v-if="userRanking.rank > 0">
            <div class="user-rank-main">
                <div class="user-rank">#{{ userRanking.rank }}</div>
                <div class="user-rank-tier">
                    {{ userRanking.userStats?.rankTier }}
                    <span v-if="userRanking.userStats?.rankSubTier">{{ userRanking.userStats.rankSubTier }}</span>
                </div>
            </div>
            <div class="user-stats-grid">
                <div class="user-stat">
                    <div class="stat-label">æ®µä½åˆ†</div>
                    <div class="stat-value">{{ userRanking.userStats?.rankPoints }}</div>
                </div>
                <div class="user-stat">
                    <div class="stat-label">ç­‰çº§</div>
                    <div class="stat-value">Lv.{{ userRanking.userStats?.level }}</div>
                </div>
                <div class="user-stat">
                    <div class="stat-label">èƒœç‡</div>
                    <div class="stat-value">{{ userRanking.userStats?.winRate }}%</div>
                </div>
                <div class="user-stat">
                    <div class="stat-label">è¡¨ç°</div>
                    <div class="stat-value">{{ userRanking.userStats?.performanceGrade }}</div>
                </div>
            </div>
        </div>
        <div class="user-ranking-info" v-else>
            <p>æš‚æ— æ’åæ•°æ®ï¼Œå‚ä¸æ’ä½èµ›å³å¯è·å¾—æ’å</p>
        </div>

        <div class="nav-buttons">
            <el-button type="primary" @click="goToBattle">å¼€å§‹æˆ˜æ–—</el-button>
            <el-button @click="goToBackpack">æˆ‘çš„èƒŒåŒ…</el-button>
            <el-button @click="goToMarket">æ­¦å™¨å¸‚åœº</el-button>
        </div>
    </div>

    <!-- æ§åˆ¶é¢æ¿ -->
    <div class="controls-panel">
        <div class="filter-controls">
            <el-select v-model="filterTier" placeholder="ç­›é€‰æ®µä½" clearable @change="loadRanking">
                <el-option label="å…¨éƒ¨æ®µä½" value=""></el-option>
                <el-option label="ä¼ è¯´" value="LEGEND"></el-option>
                <el-option label="ç¥è¯" value="MYTHIC"></el-option>
                <el-option label="å¤§å¸ˆ" value="MASTER"></el-option>
                <el-option label="é’»çŸ³" value="DIAMOND"></el-option>
                <el-option label="é“‚é‡‘" value="PLATINUM"></el-option>
                <el-option label="é»„é‡‘" value="GOLD"></el-option>
                <el-option label="ç™½é“¶" value="SILVER"></el-option>
                <el-option label="é’é“œ" value="BRONZE"></el-option>
            </el-select>

            <el-button
                    type="primary"
                    @click="loadRanking"
                    :loading="loading"
                    icon="Refresh">
                åˆ·æ–°
            </el-button>

            <el-button
                    @click="refreshBots"
                    :loading="refreshingBots">
                åˆ·æ–°æœºå™¨äºº
            </el-button>
        </div>

        <div class="stats-info">
            å…± {{ totalPlayers }} åç©å®¶ | æœ€åæ›´æ–°: {{ lastUpdateTime }}
        </div>
    </div>

    <!-- æ’è¡Œæ¦œä¸»ä½“ -->
    <div class="ranking-main">
        <!-- åŠ è½½çŠ¶æ€ -->
        <div v-if="loading" class="loading">
            <el-icon class="is-loading" style="font-size: 3em;">
                <Loading />
            </el-icon>
            <p>åŠ è½½æ’è¡Œæ¦œæ•°æ®ä¸­...</p>
        </div>

        <!-- é¡¶çº§ç©å®¶å±•ç¤º -->
        <div v-else-if="rankingList.length > 0" class="top-players">
            <div v-for="player in topThreePlayers" :key="player.rank"
                 class="top-player-card" :class="getTopPlayerClass(player.rank)">
                <div class="rank-badge">{{ player.rank }}</div>
                <div v-if="player.isBot" class="bot-indicator">AI</div>

                <div class="player-avatar">
                    {{ getPlayerAvatar(player.username) }}
                </div>

                <div class="player-name">{{ player.nickname || player.username }}</div>
                <div class="player-tier">
                    {{ player.rankTier }}
                    <span v-if="player.rankSubTier">{{ player.rankSubTier }}</span>
                </div>

                <div class="player-stats">
                    <div class="player-stat">
                        <div class="stat-number">{{ player.rankPoints }}</div>
                        <div class="stat-desc">æ®µä½åˆ†</div>
                    </div>
                    <div class="player-stat">
                        <div class="stat-number">{{ player.winRate }}%</div>
                        <div class="stat-desc">èƒœç‡</div>
                    </div>
                </div>

                <div class="player-stats">
                    <div class="player-stat">
                        <div class="stat-number">{{ player.level }}</div>
                        <div class="stat-desc">ç­‰çº§</div>
                    </div>
                    <div class="player-stat">
                        <div class="stat-number">{{ player.performanceGrade }}</div>
                        <div class="stat-desc">è¡¨ç°</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ’è¡Œæ¦œåˆ—è¡¨ -->
        <div v-if="rankingList.length > 0" class="ranking-list">
            <!-- è¡¨å¤´ -->
            <div class="ranking-header">
                <div>æ’å</div>
                <div>ç©å®¶</div>
                <div>æ®µä½</div>
                <div>æ®µä½åˆ†</div>
                <div>è¡¨ç°</div>
                <div>èƒœç‡</div>
                <div>KDæ¯”</div>
            </div>

            <!-- æ’è¡Œæ¦œè¡Œ -->
            <div v-for="player in filteredRankingList" :key="player.rank"
                 class="ranking-row" :class="{ 'current-user': isCurrentUser(player.userId) }">
                <div class="rank-number" :class="getRankClass(player.rank)">
                    {{ player.rank }}
                </div>

                <div class="player-info">
                    <div class="player-avatar-small">
                        {{ getPlayerAvatar(player.username) }}
                    </div>
                    <div class="player-details">
                        <div class="player-display-name">
                            {{ player.nickname || player.username }}
                            <el-tag v-if="player.isBot" size="small" type="danger">AI</el-tag>
                        </div>
                        <div class="player-level">Lv.{{ player.level }}</div>
                    </div>
                </div>

                <div class="rank-tier-info">
                    <div class="tier-icon">
                        {{ getTierIcon(player.rankTier) }}
                    </div>
                    <div class="tier-name">{{ player.rankTier }}</div>
                    <div v-if="player.rankSubTier" class="tier-sub">{{ player.rankSubTier }}æ®µ</div>
                </div>

                <div class="rank-points">
                    {{ player.rankPoints }}
                </div>

                <div class="performance-grade" :class="'grade-' + player.performanceGrade">
                    {{ player.performanceGrade }}
                </div>

                <div class="win-rate" :class="getWinRateClass(player.winRate)">
                    {{ player.winRate }}%
                </div>

                <div class="kd-ratio">
                    {{ player.kdRatio }}
                </div>
            </div>
        </div>

        <!-- ç©ºçŠ¶æ€ -->
        <div v-else-if="!loading" class="empty-state">
            <i>ğŸ†</i>
            <h3>æš‚æ— æ’è¡Œæ¦œæ•°æ®</h3>
            <p>å‚ä¸æ’ä½èµ›å³å¯å‡ºç°åœ¨æ’è¡Œæ¦œä¸­</p>
            <el-button type="primary" style="margin-top: 20px;" @click="goToBattle">
                å¼€å§‹æ’ä½èµ›
            </el-button>
        </div>

        <!-- æ®µä½ç»Ÿè®¡ -->
        <div v-if="tierStatistics.totalPlayers > 0" class="tier-statistics">
            <h3 class="statistics-title">æ®µä½åˆ†å¸ƒç»Ÿè®¡</h3>
            <div class="tier-stats-grid">
                <div v-for="(count, tier) in tierStatistics.tierCount" :key="tier"
                     class="tier-stat-card" :class="tier.toLowerCase()">
                    <div class="tier-stat-name">{{ getTierDisplayName(tier) }}</div>
                    <div class="tier-stat-count">{{ count }} äºº</div>
                    <div class="tier-stat-percentage">
                        {{ tierStatistics.tierPercentage[tier] }}%
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const { createApp, ref, onMounted, computed, watch } = Vue;
    const { ElMessage, ElMessageBox } = ElementPlus;

    createApp({
        setup() {
            // æ’è¡Œæ¦œæ•°æ®
            const rankingList = ref([]);
            const userRanking = ref({});
            const tierStatistics = ref({
                tierCount: {},
                tierPercentage: {},
                totalPlayers: 0
            });
            const loading = ref(false);
            const refreshingBots = ref(false);
            const lastUpdateTime = ref('');

            // ç­›é€‰æ¡ä»¶
            const filterTier = ref('');

            const currentPage = ref('ranking'); // æ ¹æ®å½“å‰é¡µé¢è®¾ç½®
            const battleNotification = ref(false);
            const username = ref('ç©å®¶');
            const userInitial = ref('ç©');

            // è·å–ç”¨æˆ·ä¿¡æ¯
            const loadUserInfo = async () => {
                try {
                    const response = await axios.get('/api/user/info');
                    if (response.data.success) {
                        username.value = response.data.user.nickname || response.data.user.username;
                        userInitial.value = username.value.charAt(0);
                    }
                } catch (error) {
                    console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
                }
            };

// è®¾ç½®å½“å‰é¡µé¢
            const setCurrentPage = () => {
                const path = window.location.pathname;
                if (path.includes('backpack')) currentPage.value = 'backpack';
                else if (path.includes('market')) currentPage.value = 'market';
                else if (path.includes('battle/ranking')) currentPage.value = 'ranking';
                else if (path.includes('battle')) currentPage.value = 'battle';
            };

            // è®¡ç®—å±æ€§
            const topThreePlayers = computed(() => {
                return rankingList.value.slice(0, 3);
            });

            const filteredRankingList = computed(() => {
                if (!filterTier.value) {
                    return rankingList.value;
                }
                return rankingList.value.filter(player =>
                    player.rankTier === filterTier.value
                );
            });

            const totalPlayers = computed(() => {
                return tierStatistics.value.totalPlayers || rankingList.value.length;
            });

            // æ–¹æ³•
            const loadRanking = async () => {
                loading.value = true;
                try {
                    // åŠ è½½æ’è¡Œæ¦œåˆ—è¡¨
                    const response = await axios.get('/battle/ranking/list');
                    if (response.data.success) {
                        rankingList.value = response.data.data;
                        updateLastUpdateTime();
                    } else {
                        ElMessage.error(response.data.message);
                    }

                    // åŠ è½½ç”¨æˆ·æ’å
                    const userResponse = await axios.get('/battle/ranking/user');
                    if (userResponse.data.success) {
                        userRanking.value = userResponse.data.data;
                    }

                    // åŠ è½½æ®µä½ç»Ÿè®¡
                    await loadTierStatistics();

                } catch (error) {
                    ElMessage.error('åŠ è½½æ’è¡Œæ¦œå¤±è´¥: ' + error.message);
                } finally {
                    loading.value = false;
                }
            };

            const loadTierStatistics = async () => {
                try {
                    // è¿™é‡Œå¯ä»¥è°ƒç”¨ä¸“é—¨çš„ç»Ÿè®¡æ¥å£ï¼Œæˆ–è€…åŸºäºç°æœ‰æ•°æ®è®¡ç®—
                    const stats = calculateTierStatistics(rankingList.value);
                    tierStatistics.value = stats;
                } catch (error) {
                    console.error('åŠ è½½æ®µä½ç»Ÿè®¡å¤±è´¥:', error);
                }
            };

            const calculateTierStatistics = (players) => {
                const tierCount = {
                    'LEGEND': 0, 'MYTHIC': 0, 'MASTER': 0, 'DIAMOND': 0,
                    'PLATINUM': 0, 'GOLD': 0, 'SILVER': 0, 'BRONZE': 0
                };

                players.forEach(player => {
                    if (tierCount[player.rankTier] !== undefined) {
                        tierCount[player.rankTier]++;
                    }
                });

                const total = players.length;
                const tierPercentage = {};
                Object.keys(tierCount).forEach(tier => {
                    tierPercentage[tier] = total > 0 ?
                        Math.round((tierCount[tier] / total) * 100 * 100) / 100 : 0;
                });

                return {
                    tierCount,
                    tierPercentage,
                    totalPlayers: total
                };
            };

            const refreshBots = async () => {
                refreshingBots.value = true;
                try {
                    const response = await axios.post('/battle/ranking/refresh-bots');
                    if (response.data.success) {
                        ElMessage.success('æœºå™¨äººæ•°æ®å·²åˆ·æ–°');
                        await loadRanking();
                    } else {
                        ElMessage.error(response.data.message);
                    }
                } catch (error) {
                    ElMessage.error('åˆ·æ–°æœºå™¨äººå¤±è´¥: ' + error.message);
                } finally {
                    refreshingBots.value = false;
                }
            };

            const getTopPlayerClass = (rank) => {
                switch (rank) {
                    case 1: return 'first';
                    case 2: return 'second';
                    case 3: return 'third';
                    default: return '';
                }
            };

            const getRankClass = (rank) => {
                if (rank === 1) return 'rank-1';
                if (rank === 2) return 'rank-2';
                if (rank === 3) return 'rank-3';
                if (rank <= 10) return 'rank-4-10';
                return '';
            };

            const getPlayerAvatar = (username) => {
                if (!username) return '?';
                return username.charAt(0).toUpperCase();
            };

            const getTierIcon = (tier) => {
                const icons = {
                    'LEGEND': 'ğŸ‘‘',
                    'MYTHIC': 'ğŸŒŸ',
                    'MASTER': 'âš¡',
                    'DIAMOND': 'ğŸ’',
                    'PLATINUM': 'ğŸ”·',
                    'GOLD': 'ğŸ¥‡',
                    'SILVER': 'ğŸ¥ˆ',
                    'BRONZE': 'ğŸ¥‰'
                };
                return icons[tier] || 'ğŸ¯';
            };

            const getTierDisplayName = (tier) => {
                const names = {
                    'LEGEND': 'ä¼ è¯´',
                    'MYTHIC': 'ç¥è¯',
                    'MASTER': 'å¤§å¸ˆ',
                    'DIAMOND': 'é’»çŸ³',
                    'PLATINUM': 'é“‚é‡‘',
                    'GOLD': 'é»„é‡‘',
                    'SILVER': 'ç™½é“¶',
                    'BRONZE': 'é’é“œ'
                };
                return names[tier] || tier;
            };

            const getWinRateClass = (winRate) => {
                if (winRate >= 60) return 'win-rate-high';
                if (winRate >= 45) return 'win-rate-medium';
                return 'win-rate-low';
            };

            const isCurrentUser = (userId) => {
                // è¿™é‡Œéœ€è¦ä»sessionæˆ–å…¶ä»–åœ°æ–¹è·å–å½“å‰ç”¨æˆ·ID
                // æš‚æ—¶è¿”å›falseï¼Œå®é™…ä½¿ç”¨æ—¶éœ€è¦å®ç°
                return false;
            };

            const updateLastUpdateTime = () => {
                const now = new Date();
                lastUpdateTime.value = now.toLocaleString('zh-CN');
            };

            const goToBattle = () => {
                window.location.href = '/battle';
            };

            const goToBackpack = () => {
                window.location.href = '/backpack';
            };

            const goToMarket = () => {
                window.location.href = '/market';
            };

            // ç”Ÿå‘½å‘¨æœŸ
            onMounted(() => {
                loadRanking();
                setCurrentPage();
                loadUserInfo();
            });

            return {
                // æ•°æ®
                rankingList,
                userRanking,
                tierStatistics,
                loading,
                refreshingBots,
                lastUpdateTime,
                filterTier,
                // è®¡ç®—å±æ€§
                topThreePlayers,
                filteredRankingList,
                totalPlayers,
                // æ–¹æ³•
                loadRanking,
                refreshBots,
                getTopPlayerClass,
                getRankClass,
                getPlayerAvatar,
                getTierIcon,
                getTierDisplayName,
                getWinRateClass,
                isCurrentUser,
                goToBattle,
                goToBackpack,
                goToMarket
            };
        }
    })
        .use(ElementPlus)
        .mount('#app');
</script>
</body>
</html>